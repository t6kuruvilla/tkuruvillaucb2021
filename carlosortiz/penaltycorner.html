<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<title>The Penalty Shootout Corner</title>
	<meta name="description" content="Scrollama: Sticky Side Example" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<script src="https://cdn.jsdelivr.net/npm/vega@5.21.0"></script>
	<script src="https://cdn.jsdelivr.net/npm/vega-lite@5.2.0"></script>
	<script src="https://cdn.jsdelivr.net/npm/vega-embed@6.20.2"></script>
	<script src="https://unpkg.com/papaparse@5.3.2/papaparse.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.8/d3.min.js" type="text/JavaScript"></script>
	<script src="./penaltyNumber.js"></script>
	<script src="./dataZone.js"></script>
	<script src="./dataRatios.js"></script>
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

	<style media="screen">
		/* Add space between Vega-Embed links  */
		.vega-actions a {
			margin-right: 5px;
		}
	</style>

	<link rel="stylesheet" href="./style.css" />
	<style>
		#scrolly {
			position: relative;
			display: -webkit-box;
			display: -ms-flexbox;
			display: flex;
			background-color: #f3f3f3;
			padding: 1rem;
		}

		#scrolly>* {
			-webkit-box-flex: 1;
			-ms-flex: 1;
			flex: 1;
		}

		article {
			position: relative;
			padding: 0 1rem;
			max-width: 20rem;
		}

		figure {
			position: -webkit-sticky;
			position: sticky;
			width: 100%;
			margin: 0;
			-webkit-transform: translate3d(0, 0, 0);
			-moz-transform: translate3d(0, 0, 0);
			transform: translate3d(0, 0, 0);
			background-color:#f3f3f3;
			z-index: 0;
		}

		figure p {
			text-align: center;
			padding: 1rem;
			position: absolute;
			top: 50%;
			left: 50%;
			-moz-transform: translate(-50%, -50%);
			-webkit-transform: translate(-50%, -50%);
			transform: translate(-50%, -50%);
			font-size: 8rem;
			font-weight: 900;
			color: #fff;
		}

		.step {
			margin: 0 auto 2rem auto;
			background-color: #000000;
			color: #fff;
		}

		.step:last-child {
			margin-bottom: 0;
		}

		.step.is-active {
			background-color: rgb(255, 255, 255);
			color: #3b3b3b;
		}

		.step p {
			text-align: center;
			padding: 1rem;
			font-size: 1rem;
		}
	</style>
</head>

<body>

	<!-- Navbar -->
<div class="w3-top">
	<div class="w3-bar w3-theme-d2 w3-left-align">
	 <a class="w3-bar-item w3-button w3-hide-medium w3-hide-large w3-right w3-hover-white w3-theme-d2" href="javascript:void(0);" onclick="openNav()"><i class="fa fa-bars"></i></a>
	 <a href="../index.html" class="w3-bar-item w3-button w3-teal"><i class="fa fa-home w3-margin-right"></i>HOME</a>
	 <a href="../theresa/history.html" class="w3-bar-item w3-button w3-hide-small w3-hover-white">History</a>
	 <a href="../carlosM/index.html" class="w3-bar-item w3-button w3-hide-small w3-hover-white">World Cup and FIFA Ranking</a>
	 <a href="../chris/wc_2018.html" class="w3-bar-item w3-button w3-hide-small w3-hover-white">World Cup 2018 - Deep Dive</a>
	 <a href="../theresa/qatar2022.html" class="w3-bar-item w3-button w3-hide-small w3-hover-white">World Cup 2022</a>
	 <a href="../about_us.html" class="w3-bar-item w3-button w3-hide-small w3-hover-white">About Us</a>
	 </div>
	 </div>

	<main>
		<section id="intro">
			<br>
			<br>
			<br>
			<h1 class="intro__hed">The Penalty Shootout Corner</h1>
			<p class="intro__dek">
				<br>
			<h3>A quick intro: What is this all about?</h3>
			<br>
			Welcome to the Penalty Shootout Corner. In 2018, The Economist wrote an articled titled "Penalty shoot-outs are
			basically still crap-shoots". The article presented a data driven insight suggetsing that penalty shootouts
			pretty much chance events.
			This site will let you lay rest to this question and make up your own mind based on data. In 10 minutes and
			a few clicks we expect you to have
			a data driven conclussion on whether penalty shootouts are chance events or not. Please follow the steps and
			instructions bellow to participate.
			<br><br>
			<h3>Step 1: Select your ELITE TEAMS</h3>
			<br>
			To answer this question, we'll begin with an assumption: if penalty shootouts are in fact a chance event,
			then we should not be able to see significant differences in performance between elite and non-elite teams
			would we? If elite teams are performing better on penalty shootouts, wouldn't that mean that penalty
			shootouts are not chance events, and that the skill, mental clarity and stress management that comes with
			being elite improves your chances of success? We don't want to bias you on what consititutes an elite team.
			It's entirely your call. Choose on the menu bellow, between eight and 10 teams that you consider elite.
			Make sure that the ~8 to 10 teams you choose are what you personally consider the best amongst the list of
			all teams available. Everything you don't choose will be sent to the NON-ELITE team list. 
			</p>
			<br>

			<fieldset>
				<legend>&nbsp&nbspChoose your ELITE countries:&nbsp&nbsp</legend>
				<table style="width:100%">
					<tr>
						<td>
							<input type="checkbox" name="country_list" value="ARG">Argentina<br>
							<input type="checkbox" name="country_list" value="BRA">Brazil<br>
							<input type="checkbox" name="country_list" value="BUL">Bulgaria<br>
							<input type="checkbox" name="country_list" value="CRA">Canada<br>
							<input type="checkbox" name="country_list" value="CHI">Chile<br>
							<input type="checkbox" name="country_list" value="COL">Colombia<br>
							<input type="checkbox" name="country_list" value="CRO">Croatia<br>
						</td>
						<td>
							<input type="checkbox" name="country_list" value="DEN">Denmark<br>
							<input type="checkbox" name="country_list" value="ENG">England<br>
							<input type="checkbox" name="country_list" value="FRA">France<br>
							<input type="checkbox" name="country_list" value="GER">Germany<br>
							<input type="checkbox" name="country_list" value="GHA">Ghana<br>
							<input type="checkbox" name="country_list" value="GRE">Greece<br>
							<input type="checkbox" name="country_list" value="HOL">Holland<br>
						</td>
						<td>
							<input type="checkbox" name="country_list" value="RUM">Hungary<br>
							<input type="checkbox" name="country_list" value="IRE">Ireland<br>
							<input type="checkbox" name="country_list" value="ITA">Italy<br>
							<input type="checkbox" name="country_list" value="JAP">Japan<br>
							<input type="checkbox" name="country_list" value="MEX">Mexico<br>
							<input type="checkbox" name="country_list" value="POR">Portugal<br>
							<input type="checkbox" name="country_list" value="ROM">Romania<br>
						</td>
						<td>
							<input type="checkbox" name="country_list" value="RUS">Russia<br>
							<input type="checkbox" name="country_list" value="SPA">Spain<br>
							<input type="checkbox" name="country_list" value="SWE">Sweden<br>
							<input type="checkbox" name="country_list" value="SWZ">Switzerland<br>
							<input type="checkbox" name="country_list" value="UKR">Ukraine<br>
							<input type="checkbox" name="country_list" value="URU">Uruguay<br>
							<input type="checkbox" name="country_list" value="YUG">Yugoslavia<br>
						</td>
					</tr>
				</table>

				<br>
			</fieldset>

		</section>

		<section id="scrolly">
			<article>
				<div class="step" data-step="1">
					<p><b>Conversion Rate</b>
						<br><br>
						Let's begin with conversion rates. 
						<br><br>
						By conversion rates we mean how many penalty kicks does a team convert from the total they take.
						Again, if penalty shootouts are chance events, the conversion rates of the best team and the worst team should not be statistically significant correct?
						Would you expect to have a better conversion rate in a flip coin contest against anyone in the world (good or bad at flip coin)?
						You wouldn't, right?
						<br><br> 
						Take a look at the teams you chose as elites (left hand plot) and the teams on the non elite list (right hand plot).
						<br><br>
						Do they look different to you? Is there any interesting insight you can learn from this information about the performance of elites vs non elites?
					</p>
				</div>
				<div class="step" data-step="2">
					<p><b>Conversion Rate per Number of Penalty on Shootout</b>
						<br><br>
						Let's look at the conversion rate of ELITE team's vs NON ELITE TEAMS based on the number of
						penalties on a penalty shootout.
						<br><br>
						In a world in which penalty shootouts are driven by chance, we should not be able to see a
						difference in performance across both groups.
						<br><br>
						One thing to keep on mind here is that the first penalty kick of a shootout is normally taken by
						the best player on the team.
						This is done to maximize conversion potential and keep morale high across the shootout.
						<br><br>
						Take a look at the performance of your selected teams in the initial penalty kicks.
						Also, take a look at how the performance evolves as the penalty shootout advances.
						<br><br>
						Do you think that there is enough evidence to suggest that your elite teams are performing
						better overall?
						<br><br>
						How about in the first penalty kick?
						<br><br>
						In the initial group of penalty kicks? How about the last penalty kicks in the shootout?
						<br><br>
						What does the data you're observing tell you about the performance of ELITE vs NON ELITE teams?
					</p>
				</div>
				<div class="step" data-step="3">
					<p><b>Conversion Rate pero Goal Zone</b>
						<br><br>
						Now we come to the goal zone.
						<br><br>
						The grid you see represents the goal and each of the nine zones that the goal has been divided into for this exercise.
						<br><br>
						The label you see in each zone represents the conversion rate of penalties shot into that zone by elites (left hand) and non elites (right hand).
						<br><br>
						What can you learn about the conversion rates? 
						<br><br>
						Would you expect elite teams to have more speed in their shootings (more strength), and this better conversion rates per zone?
						<br><br>
						What about the center zone where the goal keeper traditionally stands? Are there differences between elite and non elite teams when shooting at the center?
						What does that tell you about the confidence of the shooter on his own skills?
					</p>
				</div>
			</article>

			<figure>
				<div id="vis"></div>
			</figure>
		</section>

		<section id="outro"></section>
	</main>

	<!-- <div class='debug'></div> -->
	<script src="https://unpkg.com/d3@5.9.1/dist/d3.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	<script src="./scrollama.min.js"></script>
	<script>
		// using d3 for convenience
		var main = d3.select("main");
		var scrolly = main.select("#scrolly");
		var figure = scrolly.select("figure");
		var article = scrolly.select("article");
		var step = article.selectAll(".step");

		// initialize the scrollama
		var scroller = scrollama();

		// generic window resize listener event
		function handleResize() {
			// 1. update height of step elements
			var stepH = Math.floor(window.innerHeight * 1);
			step.style("height", stepH + "px");

			var figureHeight = window.innerHeight / 2;
			var figureMarginTop = (window.innerHeight - figureHeight) / 2;

			figure
				.style("height", figureHeight + "px")
				.style("top", figureMarginTop + "px");

			// 3. tell scrollama to update new element dimensions
			scroller.resize();
		}

		// scrollama event handlers
		function handleStepEnter(response) {
			console.log(response);
			// response = { element, direction, index }

			// add color to current step only
			step.classed("is-active", function (d, i) {
				return i === response.index;
			});

			// update graphic based on step
			chart = getChart(response.index + 1)
			figure.select("div").html(chart);
		}

		function init() {

			// 1. force a resize on load to ensure proper dimensions are sent to scrollama
			handleResize();

			// 2. setup the scroller passing options
			// 		this will also initialize trigger observations
			// 3. bind scrollama event handlers (this can be chained like below)
			scroller
				.setup({
					step: "#scrolly article .step",
					offset: 0.33,
					debug: false
				})
				.onStepEnter(handleStepEnter);
		}

		function getChart(index) {

			countries = selectedCountries()

			switch (index) {
				case 1:
					return vegaEmbed('#vis', chart1(countries));
				case 2:
					return vegaEmbed('#vis', chart2(countries));
				case 3:
					return vegaEmbed('#vis', chart3(countries));
			}
		}

		function selectedCountries() {

			var countries = document.getElementsByName("country_list")

			selected_countries = []

			for (var i = 0; i < countries.length; i++) {

				if (countries[i].checked)
					selected_countries.push(countries[i].value)

			}

			return (selected_countries)
		}

		function chart1(countries) {

			var chart1aData = dataRatios.filter(chart1aData => countries.indexOf(chart1aData.Team) !== -1)
			var chart1bData = dataRatios.filter(chart1bData => countries.indexOf(chart1bData.Team) == -1)

			return {

				$schema: 'https://vega.github.io/schema/vega-lite/v5.json',
				hconcat: [
					{
						width: 570,
						height: 492,
						title: "Elite team global conversion rate (penalty shots converted / all taken penalty shots)",
						data: { values: chart1aData },
						mark: {
							type: "bar",
							"bar": {
								"color": "Team",
								"tooltip": { "content": "ratio" }
							},
						},
						encoding: {
							y: {
								field: 'Team',
								type: 'nominal',
								sort: "-x"
							},
							x: {
								aggregate: 'average',
								field: 'ratio',
								type: 'quantitative',
								axis: {
									title: 'Rate of conversion (scored penalties / total penalties)'
								}
							}
						}
					},
					{

						width: 570,
						height: 492,
						title: "Non-Elite team global conversion rate (penalty shots converted / all taken penalty shots)",
						data: { values: chart1bData },
						mark: {
							type: "bar",
							"bar": {
								"color": "Team",
								"tooltip": { "content": "ratio" }
							},
						},
						encoding: {
							y: {
								field: 'Team',
								type: 'nominal',
								sort: "-x"
							},
							x: {
								aggregate: 'average',
								field: 'ratio',
								type: 'quantitative',
								axis: {
									title: 'Rate of conversion (scored penalties / total penalties)'
								}
							}
						}


					},

				]
			}
		}

		function chart2(countries) {

			var chart2aData = penaltyData.filter(chart2aData => countries.indexOf(chart2aData.Team) !== -1)
			var chart2bData = penaltyData.filter(chart2bData => countries.indexOf(chart2bData.Team) == -1)

			return {
				$schema: 'https://vega.github.io/schema/vega-lite/v5.json',
				hconcat: [
					{
						width: 550,
						height: 485,
						title: "Elite team conversion rate per number of penalty kick on shootout",
						data: { values: chart2aData },
						layer: [
							{
								mark: {
									type: "line",
									"line": {
										"color": "white",
										"tooltip": { "content": "Goal" }
									},
									"point": {
										"filled": false,
										"fill": "white",
										"tooltip": { "content": "Goal" }
									},
								},
								encoding: {
									x: {
										"field": "Penalty_Number",
										"type": "quantitative",
										"axis": { "values": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] },
										"title": "Number of Penalty on Shootout"
									},
									y: {
										"aggregate": "mean",
										"field": "Goal",
										"type": "quantitative",
										"scale": { "domain": [0, 1] },
										"title": "Conversion Rate (penalties scored / total penalties taken)"
									},
									legend: null,
									color: { "field": "symbol", "type": "nominal" }
								}
							},
							{
								mark: { "type": "line", "color": "firebrick" },
								transform: [
									{ regression: "Goal", "on": "Penalty_Number" }
								],
								encoding: {
									x: {
										"field": "Penalty_Number",
										"type": "quantitative",
										"axis": { "values": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] }
									},
									y: {
										"field": "Goal",
										"type": "quantitative",
										"scale": { "domain": [0, 1] }
									},
									legend: null,
								}
							}
						]
					},
					{
						width: 550,
						height: 485,
						title: "Non-Elite team conversion rate per number of penalty kick on shootout",
						data: { values: chart2bData },
						layer: [
							{
								mark: {
									type: "line",
									"line": {
										"color": "white",
										"tooltip": { "content": "Goal" }
									},
									"point": {
										"filled": false,
										"fill": "white",
										"tooltip": { "content": "Goal" }
									},
								},
								encoding: {
									x: {
										"field": "Penalty_Number",
										"type": "quantitative",
										"axis": { "values": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] },
										"title": "Number of Penalty on Shootout"
									},
									y: {
										"aggregate": "mean",
										"field": "Goal",
										"type": "quantitative",
										"scale": { "domain": [0, 1] },
										"title": "Conversion Rate (penalties scored / total penalties taken)"
									},
									legend: null,
									color: { "field": "symbol", "type": "nominal" }
								}
							},
							{
								mark: { "type": "line", "color": "firebrick" },
								transform: [
									{ regression: "Goal", "on": "Penalty_Number" }
								],
								encoding: {
									x: {
										"field": "Penalty_Number",
										"type": "quantitative",
										"axis": { "values": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] }
									},
									y: {
										"field": "Goal",
										"type": "quantitative",
										"scale": { "domain": [0, 1] }
									},
									legend: null,
								}
							}
						]
					},

				]
			}

		}

		function chart3(countries) {

			var chart3aData = dataZone.filter(chart3aData => countries.indexOf(chart3aData.Team) !== -1)
			var chart3bData = dataZone.filter(chart3bData => countries.indexOf(chart3bData.Team) == -1)

			return {

				"$schema": "https://vega.github.io/schema/vega-lite/v5.json",

				hconcat: [
					{

						width: 550,
						height: 500,
						data: { values: chart3aData },
						encoding: {
							y: { "field": "Y", "type": "quantitative", "title": "" },
							x: { "field": "X", "type": "quantitative", "title": "" },
						},
						layer: [
							{
								title: "Elite team global conversion rate per goal zone",
								data: { values: chart3aData },
								mark: {
									type: "rect",
									"tooltip": { "content": "data" },
								},
								encoding: {
									y: { "field": "Y", "type": "quantitative", "title": "" },
									x: { "field": "X", "type": "quantitative", "title": "" },
									color: { "aggregate": "mean", "field": "Goal" },
									encoding: {
										text: { "aggregate": "mean", "field": "Goal" }
									}

								}
							},
							{
								mark: {
									"type": "point",
									"size": 0
								}
							},
							{
								mark: {
									"type": "text",
									"fontSize": { "expr": 33 },
									"xOffset": { "expr": -100 },
									"yOffset": { "expr": 80 }
								},

								encoding: {
									text: {
										"aggregate": "mean",
										"field": "Goal",
										"format": ".2%"
									}
								}
							}
						]

					},
					{

						width: 550,
						height: 500,
						data: { values: chart3bData },
						encoding: {
							y: { "field": "Y", "type": "quantitative", "title": "" },
							x: { "field": "X", "type": "quantitative", "title": "" },
						},
						layer: [
							{
								title: "Non-Elite team global conversion rate per goal zone",
								data: { values: chart3bData },
								mark: {
									type: "rect",
									"tooltip": { "content": "data" },
								},
								encoding: {
									y: { "field": "Y", "type": "quantitative", "title": "" },
									x: { "field": "X", "type": "quantitative", "title": "" },
									color: { "aggregate": "mean", "field": "Goal" },
									encoding: {
										text: { "aggregate": "mean", "field": "Goal" }
									}

								}
							},
							{
								mark: {
									"type": "point",
									"size": 0
								}
							},
							{
								mark: {
									"type": "text",
									"fontSize": { "expr": 33 },
									"xOffset": { "expr": -100 },
									"yOffset": { "expr": 80 }
								},
								encoding: {
									text: {
										"aggregate": "mean",
										"field": "Goal",
										"format": ".2%"
									}
								}
							}
						]

					},
				]
			};
		}

		// kick things off
		init();
	</script>
</body>

</html>